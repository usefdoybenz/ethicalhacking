{"id":114,"date":"2024-02-06T23:55:46","date_gmt":"2024-02-06T22:55:46","guid":{"rendered":"http:\/\/localhost\/ethicalhacking\/?page_id=114"},"modified":"2024-02-06T23:55:46","modified_gmt":"2024-02-06T22:55:46","slug":"vulnerabilidad-smbenumeracionrecursoscompartidos","status":"publish","type":"page","link":"http:\/\/localhost\/ethicalhacking\/vulnerabilidad-smbenumeracionrecursoscompartidos\/","title":{"rendered":"Enumeraci\u00f3n SMB (listar recursos compartidos)"},"content":{"rendered":"\n<p>Definici\u00f3n:<\/p>\n\n\n\n<p><br>La enumeraci\u00f3n SMB (Server Message Block) se refiere al proceso de recopilar informaci\u00f3n sobre recursos compartidos, usuarios y grupos en una red que utiliza el protocolo SMB. Esto implica identificar y listar los recursos disponibles, como archivos, impresoras o dispositivos, as\u00ed como obtener informaci\u00f3n sobre los usuarios y grupos que tienen acceso a estos recursos. La enumeraci\u00f3n SMB es una etapa cr\u00edtica en la evaluaci\u00f3n de la seguridad de una red, ya que puede ayudar a identificar posibles vulnerabilidades y puntos d\u00e9biles que podr\u00edan ser explotados por atacantes.<\/p>\n\n\n\n<p>El servicio SMB (Server Message Block) utiliza el puerto TCP 445 como predeterminado para la comunicaci\u00f3n en redes modernas que utilizan SMB sobre TCP\/IP.<\/p>\n\n\n\n<p>Para esta vulnerabilidad utilizaremos la m\u00e1quina Active (10.10.10.100) de la plataforma Hack The Box. <\/p>\n\n\n\n<p>Active es una m\u00e1quina Windows, tras el escaneo con nmap nos reporta que tiene varios puertos abiertos, entre ellos el puerto 445:<\/p>\n\n\n\n<p><strong>sudo nmap -p- &#8211;open -sS &#8211;min-rate 5000 -vvv -n -Pn 10.10.10.100 -oG allPorts<\/strong><\/p>\n\n\n\n<figure class=\"wp-block-image is-resized\"><img decoding=\"async\" src=\"http:\/\/localhost\/ethicalhacking\/wp-content\/uploads\/2024\/02\/image-20.png\" alt=\"La imagen tiene un atributo ALT vac\u00edo; su nombre de archivo es image-19.png\" style=\"width:1012px;height:auto\"\/><\/figure>\n\n\n\n<p>En primer lugar, sin necesidad de disponer de credenciales, vamos a listar los recursos compartidos (null session) con smbclient:<\/p>\n\n\n\n<p><strong>smbclient -L 10.10.10.100 -N<\/strong><\/p>\n\n\n\n<figure class=\"wp-block-image size-full is-resized\"><img loading=\"lazy\" decoding=\"async\" width=\"1025\" height=\"506\" src=\"http:\/\/localhost\/ethicalhacking\/wp-content\/uploads\/2024\/02\/image-21.png\" alt=\"\" class=\"wp-image-117\" style=\"width:1012px;height:auto\"\/><\/figure>\n\n\n\n<p>A continuaci\u00f3n con smbmap trataremos de mostrar la capacidad de lectura y escritura de cada recurso compartido que hemos listado anteriormente:<\/p>\n\n\n\n<p><strong>smbmap -H 10.10.10.100<\/strong><\/p>\n\n\n\n<p>El resultado nos indica que tenemos capacidad de lectura en la carpeta o recurso llamado \u00abReplication\u00bb <\/p>\n\n\n\n<figure class=\"wp-block-image size-full is-resized\"><img loading=\"lazy\" decoding=\"async\" width=\"1029\" height=\"418\" src=\"http:\/\/localhost\/ethicalhacking\/wp-content\/uploads\/2024\/02\/image-22.png\" alt=\"\" class=\"wp-image-118\" style=\"width:1010px;height:auto\"\/><\/figure>\n\n\n\n<p>Una vez que hemos identificado el recurso vulnerable, vamos a proceder a listar todo su contenido en busca de alg\u00fan archivo importante:<\/p>\n\n\n\n<p>Ejecutamos el comando siguiente para entrar el la carpeta  \u00abReplication\u00bb:<\/p>\n\n\n\n<p><strong>smbmap -H 10.10.10.100 -r Replication\/active.htb<\/strong><\/p>\n\n\n\n<p>Y as\u00ed sucesivamente iremos ejecutando el comando para cada subcarpeta:<\/p>\n\n\n\n<figure class=\"wp-block-image size-full is-resized\"><img loading=\"lazy\" decoding=\"async\" width=\"1021\" height=\"779\" src=\"http:\/\/localhost\/ethicalhacking\/wp-content\/uploads\/2024\/02\/image-23.png\" alt=\"\" class=\"wp-image-119\" style=\"width:1012px;height:auto\"\/><\/figure>\n\n\n\n<p>Seguimos enumerando todas las sub carpetas y parece ser que hemos encontrado un archivo interesante llamado \u00abGroups.xml\u00bb:<\/p>\n\n\n\n<figure class=\"wp-block-image size-full is-resized\"><img loading=\"lazy\" decoding=\"async\" width=\"1047\" height=\"340\" src=\"http:\/\/localhost\/ethicalhacking\/wp-content\/uploads\/2024\/02\/image-24.png\" alt=\"\" class=\"wp-image-120\" style=\"width:1010px;height:auto\"\/><\/figure>\n\n\n\n<p>Para descargar ese archivo y explorar su contenido ejecutamos el siguiente comando:<\/p>\n\n\n\n<p><strong>smbmap -H 10.10.10.100 &#8211;download Replication\/active.htb\/Policies\/{31B2F340-016D-11D2-945F-00C04FB984F9}\/MACHINE\/Preferences\/Groups\/Groups.xml<\/strong><\/p>\n\n\n\n<figure class=\"wp-block-image size-full is-resized\"><img loading=\"lazy\" decoding=\"async\" width=\"1473\" height=\"304\" src=\"http:\/\/localhost\/ethicalhacking\/wp-content\/uploads\/2024\/02\/image-25.png\" alt=\"\" class=\"wp-image-121\" style=\"width:1008px;height:auto\"\/><\/figure>\n\n\n\n<p>Con el comando cat visualizamos el archivo descargado y parece contener una contrase\u00f1a cifrada o cpassword:<\/p>\n\n\n\n<p>cpassword=\u00bbedBSHOwhZLTjt\/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw\/NglVmQ\u00bb<\/p>\n\n\n\n<figure class=\"wp-block-image size-full is-resized\"><img loading=\"lazy\" decoding=\"async\" width=\"1856\" height=\"322\" src=\"http:\/\/localhost\/ethicalhacking\/wp-content\/uploads\/2024\/02\/image-26.png\" alt=\"\" class=\"wp-image-122\" style=\"width:1002px;height:auto\"\/><\/figure>\n\n\n\n<p>La contrase\u00f1a no est\u00e1 en texto claro, pero con la herramienta <strong>gpp-decrypt<\/strong> podemos descifrarla:<\/p>\n\n\n\n<p>gpp-decrypt &#8216;edBSHOwhZLTjt\/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw\/NglVmQ&#8217;<\/p>\n\n\n\n<p><br>GPPstillStandingStrong2k18<\/p>\n\n\n\n<figure class=\"wp-block-image size-full is-resized\"><img loading=\"lazy\" decoding=\"async\" width=\"1292\" height=\"237\" src=\"http:\/\/localhost\/ethicalhacking\/wp-content\/uploads\/2024\/02\/image-27.png\" alt=\"\" class=\"wp-image-123\" style=\"width:1003px;height:auto\"\/><\/figure>\n\n\n\n<p>Hemos descubierto una  contrase\u00f1a  (GPPstillStandingStrong2k18) que el propio archivo nos indica que pertenece al usuario de \u00abSVC_TGS\u00bb, todo apunta que con estas credenciales podemos acceder a todas las carpetas compartidas a nivel de red tal como se muestra a continuaci\u00f3n con el comando netexec:<\/p>\n\n\n\n<p><strong>netexec smb 10.10.10.100 -u &#8216;SVC_TGS&#8217; -p &#8216;GPPstillStandingStrong2k18&#8217; &#8211;shares<\/strong><\/p>\n\n\n\n<figure class=\"wp-block-image size-full is-resized\"><img loading=\"lazy\" decoding=\"async\" width=\"1271\" height=\"410\" src=\"http:\/\/localhost\/ethicalhacking\/wp-content\/uploads\/2024\/02\/image-28.png\" alt=\"\" class=\"wp-image-124\" style=\"width:1008px;height:auto\"\/><\/figure>\n\n\n\n<p>Efectivamente, hemos comprobado con smbmap que las credenciales descifradas nos permiten acceder a todas las carpetas, unidades y directorios dentro del sistema (por ejemplo a la carpeta Uses de Windows)<\/p>\n\n\n\n<p><strong>smbmap -H 10.10.10.100 -u &#8216;SVC_TGS&#8217; -p &#8216;GPPstillStandingStrong2k18&#8217; -r Users<\/strong><\/p>\n\n\n\n<figure class=\"wp-block-image size-full is-resized\"><img loading=\"lazy\" decoding=\"async\" width=\"1245\" height=\"439\" src=\"http:\/\/localhost\/ethicalhacking\/wp-content\/uploads\/2024\/02\/image-29.png\" alt=\"\" class=\"wp-image-125\" style=\"width:1004px;height:auto\"\/><\/figure>\n","protected":false},"excerpt":{"rendered":"<p>Definici\u00f3n: La enumeraci\u00f3n SMB (Server Message Block) se refiere al proceso de recopilar informaci\u00f3n sobre recursos compartidos, usuarios y grupos en una red que utiliza el protocolo SMB. Esto implica identificar y listar los recursos disponibles, como archivos, impresoras o dispositivos, as\u00ed como obtener informaci\u00f3n sobre los usuarios y grupos que tienen acceso a estos [&hellip;]<\/p>\n","protected":false},"author":1,"featured_media":0,"parent":0,"menu_order":0,"comment_status":"closed","ping_status":"closed","template":"","meta":{"footnotes":""},"_links":{"self":[{"href":"http:\/\/localhost\/ethicalhacking\/wp-json\/wp\/v2\/pages\/114"}],"collection":[{"href":"http:\/\/localhost\/ethicalhacking\/wp-json\/wp\/v2\/pages"}],"about":[{"href":"http:\/\/localhost\/ethicalhacking\/wp-json\/wp\/v2\/types\/page"}],"author":[{"embeddable":true,"href":"http:\/\/localhost\/ethicalhacking\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"http:\/\/localhost\/ethicalhacking\/wp-json\/wp\/v2\/comments?post=114"}],"version-history":[{"count":2,"href":"http:\/\/localhost\/ethicalhacking\/wp-json\/wp\/v2\/pages\/114\/revisions"}],"predecessor-version":[{"id":129,"href":"http:\/\/localhost\/ethicalhacking\/wp-json\/wp\/v2\/pages\/114\/revisions\/129"}],"wp:attachment":[{"href":"http:\/\/localhost\/ethicalhacking\/wp-json\/wp\/v2\/media?parent=114"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}